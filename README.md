# LVL.AI - Social Leaderboard & Friends Feature

## New Feature: Social Leaderboard & Friends Hub
I have added a **Social Leaderboard & Friends Hub** to the LVL.AI platform. This feature enhances the user experience by adding a social dimension to the productivity app.

### Key Functionalities:
1.  **Global Leaderboard**: Users can view a ranking of all users based on their XP (Experience Points). This gamifies the productivity experience.
2.  **Friend Requests**: Users can send friend requests directly from the leaderboard to connect with other high-performing users.
3.  **Friends Management**: A dedicated "My Friends" tab to view connected friends and a "Requests" tab to accept or decline incoming friend requests.
4.  **Remove Friends**: Users can remove friends from their friends list with a confirmation dialog to prevent accidental removals.

## Modified Modules
### Backend
-   **`src/routes/leaderboardRoutes.ts`** (New): Endpoint to fetch top 10 users by XP.
-   **`src/routes/friendRoutes.ts`** (Modified): Fixed critical bugs causing server crashes and added null checks for user data.
-   **`src/middleware/auth.ts`** (Modified): Updated authentication middleware to ensure consistent user ID handling (`id` vs `_id`).
-   **`src/middleware/errorHandler.ts`** (Modified): Fixed error handler to properly preserve error status codes (400, 404, etc.).
-   **`src/app.ts`** (Modified): Registered the new leaderboard routes.

### Frontend
-   **`src/app/friends/page.tsx`** (New): The main UI for the feature, implementing a tabbed interface for Leaderboard, Friends, and Requests. Includes Remove Friend functionality with confirmation dialog.
-   **`src/lib/api/client.ts`** (Modified): Added `getLeaderboard` method to the API client. Already had `removeFriend` method which is now utilized in the UI.
-   **Error Handling**: Improved error messages to display actual backend errors instead of generic messages.

## Verification
I verified the correctness of the feature through the following steps:
1.  **Backend Testing**: Used `curl` to verify the `/api/leaderboard` endpoint returns the correct JSON structure and data.
2.  **Bug Fix Verification**: Verified that the `/api/friends` endpoint no longer crashes the server when a user has no friends or the user ID is new.
3.  **Frontend Walkthrough**:
    -   Navigated to `/friends`.
    -   Verified the Leaderboard tab loads and displays users.
    -   Verified the empty state for a new user's Friends list.
    -   Confirmed the UI handles loading states and errors gracefully.

## Challenges & Assumptions
-   **Challenge**: The existing backend had a bug where `req.user.id` was undefined in some routes because the middleware only provided `_id`. I had to debug the server logs and update the `auth.ts` middleware to provide both `id` and `_id` for compatibility.
-   **Assumption**: I assumed that `xp` and `level` fields in the `User` model were the correct metrics for ranking users.

## Testing Instructions
To verify the feature, you can use the following test accounts. These accounts are generated by the seed script.

### 1. Run Seed Script
First, populate the database with test users:
```bash
cd backend
npm run seed
```

### 2. Test Accounts
All accounts use the password: `password123`

| Name | Email | XP | Level |
|------|-------|----|-------|
| Alice Johnson | alice@example.com | 1500 | 15 |
| Bob Smith | bob@example.com | 1200 | 12 |
| Charlie Davis | charlie@example.com | 900 | 9 |
| Diana Evans | diana@example.com | 600 | 6 |
| Evan Foster | evan@example.com | 300 | 3 |
| Frank Green | frank@example.com | 100 | 1 |

### 3. Verification Steps
1.  **Login**: Use one of the accounts above (e.g., `alice@example.com`) to log in.
2.  **Leaderboard**: Go to the "Social Hub" (or `/friends`) and verify that all 6 users appear on the leaderboard in the correct order (Alice #1, Frank #6).
3.  **Friend Requests**:
    -   Log in as **Alice**.
    -   Send a friend request to **Bob** from the leaderboard.
    -   Log out and log in as **Bob**.
    -   Go to "Requests" tab and accept the request.
    -   Verify Alice appears in Bob's "My Friends" list.

